# 指図削除（資産なし時のみ）の設計

## 目的
指図（プラン）は、資産・配分が一切作成されていない場合のみ削除できるようにする。資産が1件でも追加されている場合は削除を拒否し、理由をユーザーに明示する。

## スコープ
- Functions/API: 指図削除エンドポイントの追加、削除可否チェック
- Web UI: 指図詳細画面からの削除導線、理由表示

## 判定条件
- **削除可能**: `plans/{planId}/assets` が 0 件
- **削除不可**: `assets` が 1 件以上（配分未設定でも不可）

## API 仕様変更
- 追加: `DELETE /v1/cases/:caseId/plans/:planId`
- 認可: `ownerUid` が一致しない場合は 403
- 不存在: plan が無い場合は 404
- 削除不可: assets が存在する場合は 400（例: `HAS_ASSETS`）
  - メッセージ例: 「資産が追加されているため削除できません」
- 成功: plan ドキュメントを削除し 200 を返す
  - history サブコレクションは可能な範囲で削除（同一バッチ / 分割削除）

## UI 仕様変更
- 対象: `CasePlanDetailPage`
- 被相続人（owner）のみ削除ボタンを表示
- assets が 0 件のときのみ削除ボタンを有効化
- assets が 1 件以上の場合はボタンを無効化し、理由文を表示
- 削除確認のダイアログを表示し、確定で API を呼ぶ
- 成功時は ケース詳細（`/cases/:caseId`）へ遷移
- 失敗時は API のメッセージをエラー表示

## テスト方針
- Functions: 削除可（assets 0）/ 削除不可（assets あり）/ 権限なし の 3 ケース
- Web: SSR レンダリングで削除導線の表示条件を確認（最小）

## 非スコープ
- 指図の論理削除（INACTIVE 化のみ）
- 既存データのクリーンアップ運用
